!function(){window.HydrousWidget={};const n={apiUrl:"https://backend-chatbot-owzs.onrender.com/api",primaryColor:"#0891b2",secondaryColor:"#e0f2fe",position:"right",title:"Asistente Técnico",subtitle:"Consultas sobre reciclaje de agua",maxFileSize:5,allowedFileTypes:["image/*","application/pdf",".xls",".xlsx",".csv",".doc",".docx"],showBranding:!0,autoOpen:!1,autoOpenDelay:5,language:"es",enableFileUploads:!0,mobile:{fullscreen:!0,breakpoint:768}};let e={};function o(n,e,o={}){if("localhost"===window.location.hostname)return;const t={event:n,timestamp:(new Date).toISOString(),url:window.location.origin,properties:{...o,screenWidth:window.innerWidth,screenHeight:window.innerHeight,userAgent:navigator.userAgent}};try{fetch(`${e.apiUrl}/analytics/event`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),keepalive:!0}).catch((()=>{}))}catch(n){}}function t(n){try{const e=localStorage.getItem(`hydrous_${n}`);return e?JSON.parse(e):null}catch(n){return console.log("Error al leer de cache:",n),null}}function r(n,e,o){try{const r=t("last_conversation");if(r&&r.id===n){const t=r.messages||[];t.push({role:"user",content:e,timestamp:new Date},{role:"assistant",content:o,timestamp:new Date}),t.length>20&&t.splice(0,t.length-20),function(n,e){try{localStorage.setItem(`hydrous_${n}`,JSON.stringify(e))}catch(n){console.log("Error al guardar en cache:",n)}}("last_conversation",{id:n,messages:t})}}catch(n){console.log("Error al actualizar cache:",n)}}function s(n,e,o,t=!0){const r=n.querySelector(".hydrous-empty-state");r&&n.removeChild(r);const s=document.createElement("div");s.className="hydrous-message hydrous-message-user",t||(s.style.animation="none");const i=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});s.innerHTML=`\n      <div class="hydrous-message-bubble">${e?u(e):""}</div>\n      <div class="hydrous-message-time">${i}</div>\n    `,n.appendChild(s),c(n)}function i(n,e,o,t=!0){const r=n.querySelector(".hydrous-empty-state");r&&n.removeChild(r);const s=document.createElement("div");s.className="hydrous-message hydrous-message-bot",t||(s.style.animation="none");const i=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});let a="";try{a=window.marked&&window.DOMPurify?window.DOMPurify.sanitize(window.marked.parse(e)):u(e)}catch(n){console.error("Error al procesar Markdown:",n),a=u(e)}s.innerHTML=`\n      <div class="hydrous-message-bubble">${a}</div>\n      <div class="hydrous-message-time">\n        <span class="hydrous-bot-indicator"></span>\n        ${i}\n      </div>\n    `,n.appendChild(s),c(n)}function a(n){const e=n.querySelector(".hydrous-typing");e&&n.removeChild(e)}function d(n){return n<1024?n+" B":n<1048576?(n/1024).toFixed(1)+" KB":(n/1048576).toFixed(1)+" MB"}function l(n){return n.startsWith("image/")?'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>\n        <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/>\n        <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>':n.includes("pdf")?'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M12 12H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M8 12H8.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M8 16H8.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>':n.includes("excel")||n.includes("spreadsheet")||n.includes("csv")?'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M8 13H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M8 17H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M10 9H9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>':n.includes("doc")||n.includes("word")?'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M10 9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>':'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>'}function c(n){n.scrollTop=n.scrollHeight}function u(n){return n?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>"):""}window.HydrousWidget.init=function(u={}){const p={...n,...u};if(document.getElementById("hydrous-chatbot-container"))return void console.warn("Hydrous Widget ya está inicializado");const h=document.createElement("div");h.id="hydrous-loading-indicator",h.innerHTML='\n      <div style="position: fixed; bottom: 20px; right: 20px; width: 64px; height: 64px; border-radius: 50%; \n                  background-color: #f1f5f9; display: flex; align-items: center; justify-content: center; z-index: 9998;">\n        <div style="width: 30px; height: 30px; border: 3px solid #e2e8f0; \n                    border-top-color: #0891b2; border-radius: 50%; animation: hydrous-spin 1s linear infinite;"></div>\n      </div>\n      <style>\n        @keyframes hydrous-spin {\n          to { transform: rotate(360deg); }\n        }\n      </style>\n    ',document.body.appendChild(h);const g=document.createElement("div");g.id="hydrous-chatbot-container",document.body.appendChild(g),function(){if(window.marked)return;const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/marked@4.0.0/marked.min.js",n.async=!0,n.onload=function(){window.marked&&window.marked.setOptions({breaks:!0,gfm:!0,sanitize:!1})},document.head.appendChild(n);const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/dompurify@2.3.1/dist/purify.min.js",e.async=!0,document.head.appendChild(e)}(),function(n){const e=document.createElement("style");e.textContent=`\n      #hydrous-chatbot-container {\n        position: fixed;\n        z-index: 9999;\n        ${"right"===n.position?"right: 20px;":"left: 20px;"}\n        bottom: 20px;\n        font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;\n      }\n      \n      .hydrous-chat-button {\n        width: 64px;\n        height: 64px;\n        border-radius: 50%;\n        background-color: ${n.primaryColor};\n        color: white;\n        border: none;\n        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s ease;\n      }\n      \n      .hydrous-chat-button:hover {\n        transform: scale(1.05);\n      }\n      \n      .hydrous-chat-window {\n        width: 650px;\n        height: 750px;\n        border-radius: 16px;\n        overflow: hidden;\n        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);\n        background-color: white;\n        border: 1px solid rgba(0, 0, 0, 0.1);\n        animation: hydrous-slideUp 0.3s ease;\n        display: flex;\n        flex-direction: column;\n      }\n      \n      .hydrous-chat-header {\n        padding: 18px 20px;\n        background-color: ${n.primaryColor};\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n      }\n      \n      .hydrous-header-title {\n        display: flex;\n        align-items: center;\n        gap: 14px;\n      }\n      \n      .hydrous-avatar {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        background-color: rgba(255, 255, 255, 0.2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n      }\n      \n      .hydrous-title-text {\n        font-weight: 600;\n        font-size: 17px;\n        margin-bottom: 2px;\n      }\n      \n      .hydrous-subtitle-text {\n        font-size: 13px;\n        opacity: 0.9;\n      }\n      \n      .hydrous-header-actions {\n        display: flex;\n        gap: 10px;\n      }\n      \n      .hydrous-btn {\n        background-color: rgba(255, 255, 255, 0.1);\n        border: none;\n        color: white;\n        cursor: pointer;\n        width: 34px;\n        height: 34px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 0.2s, transform 0.2s;\n      }\n      \n      .hydrous-btn:hover {\n        background-color: rgba(255, 255, 255, 0.2);\n        transform: scale(1.05);\n      }\n      \n      .hydrous-messages-container {\n        flex: 1;\n        padding: 20px;\n        overflow-y: auto;\n        background-color: #f8fafc;\n        background-image: radial-gradient(circle at center, rgba(8, 145, 178, 0.03) 0%, rgba(8, 145, 178, 0) 70%);\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n      }\n      \n      .hydrous-message {\n        display: flex;\n        flex-direction: column;\n        max-width: 90%;\n        animation: hydrous-fadeIn 0.3s ease;\n      }\n      \n      .hydrous-message-user {\n        align-self: flex-end;\n      }\n      \n      .hydrous-message-bot {\n        align-self: flex-start;\n      }\n      \n      .hydrous-message-bubble {\n        padding: 12px 16px;\n        border-radius: 16px;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n        font-size: 14.5px;\n        line-height: 1.6;\n      }\n      \n      .hydrous-message-user .hydrous-message-bubble {\n        background-color: ${n.primaryColor};\n        color: white;\n        border-radius: 16px 4px 16px 16px;\n      }\n      \n      .hydrous-message-bot .hydrous-message-bubble {\n        background-color: ${n.secondaryColor};\n        color: #1e293b;\n        border-radius: 4px 16px 16px 16px;\n        border: 1px solid ${n.secondaryColor};\n      }\n      \n      /* Estilos específicos para elementos Markdown */\n      .hydrous-message-bot .hydrous-message-bubble code {\n        background-color: rgba(0,0,0,0.05);\n        padding: 2px 4px;\n        border-radius: 3px;\n        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;\n        font-size: 0.9em;\n      }\n      \n      .hydrous-message-bot .hydrous-message-bubble pre {\n        background-color: rgba(0,0,0,0.05);\n        padding: 10px;\n        border-radius: 4px;\n        margin: 10px 0;\n        overflow-x: auto;\n      }\n      \n      .hydrous-message-bot .hydrous-message-bubble pre code {\n        background-color: transparent;\n        padding: 0;\n        border-radius: 0;\n        font-size: 13px;\n        line-height: 1.5;\n        color: #1e293b;\n      }\n      \n      .hydrous-message-bot .hydrous-message-bubble ul, \n      .hydrous-message-bot .hydrous-message-bubble ol {\n        margin-top: 8px;\n        margin-bottom: 8px;\n        padding-left: 24px;\n      }\n      \n      .hydrous-message-bot .hydrous-message-bubble a {\n        color: ${n.primaryColor};\n        text-decoration: none;\n      }\n      \n      .hydrous-message-bot .hydrous-message-bubble a:hover {\n        text-decoration: underline;\n      }\n      \n      .hydrous-message-bot .hydrous-message-bubble blockquote {\n        border-left: 4px solid ${n.primaryColor}40;\n        margin: 8px 0;\n        padding-left: 12px;\n        color: #475569;\n      }\n      \n      .hydrous-message-bot .hydrous-message-bubble table {\n        border-collapse: collapse;\n        margin: 10px 0;\n        width: 100%;\n      }\n      \n      .hydrous-message-bot .hydrous-message-bubble table th,\n      .hydrous-message-bot .hydrous-message-bubble table td {\n        border: 1px solid #e2e8f0;\n        padding: 6px 10px;\n        text-align: left;\n      }\n      \n      .hydrous-message-bot .hydrous-message-bubble table th {\n        background-color: ${n.secondaryColor}80;\n      }\n      \n      .hydrous-message-time {\n        font-size: 11px;\n        color: #94a3b8;\n        margin-top: 6px;\n        padding: 0 4px;\n        display: flex;\n        align-items: center;\n        gap: 4px;\n      }\n      \n      .hydrous-bot-indicator {\n        display: inline-block;\n        width: 6px;\n        height: 6px;\n        border-radius: 50%;\n        background-color: ${n.primaryColor};\n        opacity: 0.4;\n      }\n      \n      .hydrous-typing {\n        display: flex;\n        align-self: flex-start;\n        background-color: ${n.secondaryColor};\n        padding: 10px 16px;\n        border-radius: 4px 16px 16px 16px;\n        max-width: 85%;\n        box-shadow: 0 2px 8px rgba(8, 145, 178, 0.08);\n        border: 1px solid ${n.secondaryColor};\n      }\n      \n      .hydrous-typing-dots {\n        display: flex;\n        align-items: center;\n        gap: 4px;\n      }\n      \n      .hydrous-dot {\n        width: 8px;\n        height: 8px;\n        border-radius: 50%;\n        background-color: ${n.primaryColor};\n        animation: hydrous-pulse 1.2s infinite ease-in-out;\n      }\n      \n      .hydrous-dot:nth-child(2) {\n        animation-delay: 0.2s;\n      }\n      \n      .hydrous-dot:nth-child(3) {\n        animation-delay: 0.4s;\n      }\n      \n      .hydrous-typing-text {\n        position: absolute;\n        bottom: -18px;\n        left: 10px;\n        font-size: 10px;\n        color: #94a3b8;\n      }\n      \n      .hydrous-input-container {\n        padding: 16px 20px;\n        border-top: 1px solid #e2e8f0;\n        background-color: white;\n        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);\n      }\n      \n      .hydrous-input-wrapper {\n        display: flex;\n        align-items: flex-end;\n        gap: 10px;\n        position: relative;\n        border-radius: 30px;\n        background-color: #f8fafc;\n        padding: 2px;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n        border: 1px solid #e2e8f0;\n        overflow: hidden;\n        min-height: 48px;\n      }\n      \n      .hydrous-textarea-container {\n        flex: 1;\n        position: relative;\n        overflow: hidden;\n        transition: box-shadow 0.2s ease;\n        min-height: 24px;\n      }\n      \n      .hydrous-textarea {\n        width: 100%;\n        padding: 12px 16px;\n        border: none;\n        background: transparent;\n        font-size: 15px;\n        resize: none;\n        min-height: 24px;\n        max-height: 120px;\n        outline: none;\n        line-height: 1.5;\n        transition: border-color 0.2s ease;\n        font-family: inherit;\n        overflow-y: auto;\n        box-sizing: border-box;\n        display: block;\n        white-space: pre-wrap;\n        word-wrap: break-word;\n      }\n      \n      .hydrous-textarea:focus {\n        border-color: ${n.primaryColor};\n        box-shadow: 0 0 0 2px ${n.primaryColor}20, 0 2px 4px rgba(0,0,0,0.05);\n      }\n      \n      .hydrous-textarea:disabled {\n        background-color: #f8fafc;\n        cursor: not-allowed;\n      }\n      \n      .hydrous-file-btn {\n        background-color: rgba(0, 0, 0, 0.05);\n        border: none;\n        color: #64748b;\n        cursor: pointer;\n        width: 38px;\n        height: 38px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s ease;\n        margin-right: 6px;\n      }\n      \n      .hydrous-file-btn:hover {\n        background-color: rgba(0, 0, 0, 0.1);\n        transform: translateY(-2px);\n      }\n      \n      .hydrous-file-info {\n        display: block;\n        font-size: 11px;\n        color: ${n.primaryColor};\n        margin-top: 4px;\n      }\n      \n      .hydrous-file-preview {\n        display: flex;\n        align-items: center;\n        background-color: #f1f5f9;\n        border-radius: 8px;\n        padding: 8px 12px;\n        margin-top: 8px;\n        gap: 10px;\n      }\n      \n      .hydrous-file-preview-icon {\n        color: ${n.primaryColor};\n        flex-shrink: 0;\n      }\n      \n      .hydrous-file-preview-name {\n        font-size: 12px;\n        flex-grow: 1;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      \n      .hydrous-file-preview-remove {\n        background: none;\n        border: none;\n        color: #94a3b8;\n        cursor: pointer;\n        padding: 2px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border-radius: 50%;\n      }\n      \n      .hydrous-file-preview-remove:hover {\n        background-color: rgba(0, 0, 0, 0.05);\n        color: #64748b;\n      }\n      \n      .hydrous-message-file {\n        display: flex;\n        align-items: center;\n        background-color: #f1f5f9;\n        border-radius: 8px;\n        padding: 8px 12px;\n        margin-top: 8px;\n        gap: 10px;\n        font-size: 13px;\n      }\n      \n      .hydrous-message-file-icon {\n        color: ${n.primaryColor};\n      }\n      \n      .hydrous-message-file-name {\n        flex-grow: 1;\n      }\n      \n      .hydrous-send-btn {\n        width: 44px;\n        height: 44px;\n        border-radius: 50%;\n        background-color: #e2e8f0;\n        color: white;\n        border: none;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: not-allowed;\n        transition: all 0.2s ease;\n        flex-shrink: 0;\n      }\n      \n      .hydrous-send-btn.active {\n        background-color: ${n.primaryColor};\n        cursor: pointer;\n        box-shadow: 0 4px 10px rgba(8, 145, 178, 0.2);\n      }\n      \n      .hydrous-send-btn.active:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 6px 12px rgba(8, 145, 178, 0.25);\n      }\n      \n      .hydrous-input-info {\n        margin-top: 10px;\n        font-size: 11px;\n        color: #94a3b8;\n        text-align: center;\n      }\n      \n      .hydrous-empty-state {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        height: 100%;\n        color: #64748b;\n        text-align: center;\n        padding: 20px;\n      }\n      \n      .hydrous-empty-icon {\n        width: 80px;\n        height: 80px;\n        border-radius: 50%;\n        background-color: #e0f2fe;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-bottom: 20px;\n        box-shadow: 0 6px 16px rgba(8, 145, 178, 0.1);\n      }\n      \n      .hydrous-empty-title {\n        font-size: 16px;\n        font-weight: 600;\n        margin-bottom: 12px;\n        color: #334155;\n      }\n      \n      .hydrous-empty-text {\n        font-size: 14px;\n        max-width: 280px;\n        line-height: 1.6;\n        color: #64748b;\n      }\n      \n      @keyframes hydrous-fadeIn {\n        from {\n          opacity: 0;\n          transform: translateY(5px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n      \n      @keyframes hydrous-slideUp {\n        from {\n          opacity: 0;\n          transform: translateY(10px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n      \n      @keyframes hydrous-pulse {\n        0%, 100% {\n          transform: scale(0.8);\n          opacity: 0.6;\n        }\n        50% {\n          transform: scale(1.2);\n          opacity: 1;\n        }\n      }\n      \n      @media (max-width: 768px) {\n        .hydrous-chat-window {\n          width: 100vw;\n          height: 100vh;\n          border-radius: 0;\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          z-index: 10000;\n        }\n        \n        .hydrous-messages-container {\n          padding: 16px;\n        }\n        \n        .hydrous-message {\n          max-width: 95%;\n        }\n      }\n    `,document.head.appendChild(e)}(p);!function(n,u,p){const h=document.createElement("button");h.className="hydrous-chat-button",h.setAttribute("aria-label","Abrir chat"),h.innerHTML='\n    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z" stroke="white" stroke-width="2"></path>\n    </svg>\n  ',n.appendChild(h);const g=document.createElement("div");g.className="hydrous-chat-window",g.style.display="none";const y=function(n){const e=document.createElement("div");return e.className="hydrous-chat-header",e.innerHTML=`\n      <div class="hydrous-header-title">\n        <div class="hydrous-avatar">\n          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z" stroke="white" stroke-width="2"></path>\n          </svg>\n        </div>\n        <div>\n          <div class="hydrous-title-text">${n.title}</div>\n          <div class="hydrous-subtitle-text">${n.subtitle}</div>\n        </div>\n      </div>\n      <div class="hydrous-header-actions">\n        <button class="hydrous-btn hydrous-reset-btn" title="Reiniciar conversación">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M1 4V10H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>\n            <path d="M23 20V14H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>\n            <path d="M20.49 9C19.9828 7.56678 19.1209 6.2854 17.9845 5.27542C16.8482 4.26543 15.4745 3.55976 13.9917 3.22426C12.5089 2.88875 10.9652 2.93434 9.50481 3.35677C8.04437 3.77921 6.71475 4.56471 5.64 5.64L1 10M23 14L18.36 18.36C17.2853 19.4353 15.9556 20.2208 14.4952 20.6432C13.0348 21.0657 11.4911 21.1112 10.0083 20.7757C8.52547 20.4402 7.1518 19.7346 6.01547 18.7246C4.87913 17.7146 4.01717 16.4332 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>\n          </svg>\n        </button>\n        <button class="hydrous-btn hydrous-close-btn" title="Cerrar chat">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>\n          </svg>\n        </button>\n      </div>\n    `,e}(u);g.appendChild(y);const m=document.createElement("div");m.className="hydrous-messages-container",m.innerHTML=`\n    <div class="hydrous-empty-state">\n      <div class="hydrous-empty-icon">\n        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z" stroke="${u.primaryColor}" stroke-width="2"></path>\n        </svg>\n      </div>\n      <h3 class="hydrous-empty-title">${u.title}</h3>\n      <p class="hydrous-empty-text">\n        Escriba su consulta para comenzar.\n      </p>\n    </div>\n  `,g.appendChild(m);const x=document.createElement("div");x.className="hydrous-input-container",x.innerHTML=`\n      <div class="hydrous-input-wrapper">\n        <div class="hydrous-textarea-container">\n          <textarea \n            class="hydrous-textarea" \n            placeholder="Escriba su consulta técnica..." \n            rows="1"\n          ></textarea>\n        </div>\n        ${u.enableFileUploads?`\n        <button class="hydrous-file-btn" title="Adjuntar archivo">\n          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M21.44 11.05L12.25 20.24C11.1242 21.3658 9.59723 21.9983 8.005 21.9983C6.41277 21.9983 4.88584 21.3658 3.76 20.24C2.63416 19.1142 2.00166 17.5872 2.00166 15.995C2.00166 14.4028 2.63416 12.8758 3.76 11.75L12.33 3.18C13.0806 2.42949 14.0991 2.00052 15.16 2.00052C16.2209 2.00052 17.2394 2.42949 17.99 3.18C18.7406 3.93052 19.1695 4.94901 19.1695 6.01C19.1695 7.07099 18.7406 8.08948 17.99 8.84L9.41 17.41C9.03472 17.7853 8.5262 17.9961 7.995 17.9961C7.4638 17.9961 6.95528 17.7853 6.58 17.41C6.20472 17.0347 5.99389 16.5262 5.99389 15.995C5.99389 15.4638 6.20472 14.9553 6.58 14.58L15.07 6.1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n          </svg>\n        </button>\n        <input type="file" class="hydrous-file-input" style="display: none;" accept="${u.allowedFileTypes.join(",")}" />\n        `:""}\n        <button class="hydrous-send-btn" disabled>\n          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <line x1="22" y1="2" x2="11" y2="13" stroke="currentColor" stroke-width="2"></line>\n            <polygon points="22 2 15 22 11 13 2 9 22 2" stroke="currentColor" stroke-width="2"></polygon>\n          </svg>\n        </button>\n      </div>\n      <div class="hydrous-input-info">\n        <span>Presione Enter para enviar, Shift+Enter para nueva línea</span>\n        <span class="hydrous-file-info"></span>\n      </div>\n    `,g.appendChild(x),n.appendChild(g),e={container:n,chatButton:h,chatWindow:g,messagesContainer:m,inputContainer:x,textarea:x.querySelector(".hydrous-textarea"),sendButton:x.querySelector(".hydrous-send-btn"),fileButton:x.querySelector(".hydrous-file-btn"),fileInput:x.querySelector(".hydrous-file-input"),closeButton:g.querySelector(".hydrous-close-btn"),resetButton:g.querySelector(".hydrous-reset-btn")},function(n,u){const{chatButton:p,chatWindow:h,messagesContainer:g,inputContainer:y,textarea:m,sendButton:x,fileButton:f,fileInput:b,closeButton:v,resetButton:w}=e;function k(){const n=m.value.trim().length>0,e=null!==u.selectedFile,o=(n||e)&&!u.isTyping;console.log("Estado del botón:",{hasText:n,hasFile:e,canSend:o}),o?(x.classList.add("active"),x.disabled=!1):(x.classList.remove("active"),x.disabled=!0)}function C(){const t=m.value.trim(),p=null!==u.selectedFile;if(!t&&!p||u.isTyping)console.log("No hay contenido para enviar o el bot está escribiendo");else try{if(x.disabled=!0,m.disabled=!0,p){const n=y.querySelector(".hydrous-file-info");n&&(n.textContent="Enviando archivo...")}t?s(g,t,u):p&&s(g,"",u),p&&function(n,e){const o=n.querySelector(".hydrous-message-user:last-child");if(o){const n=document.createElement("div");n.className="hydrous-message-file";const t=l(e.type),r=d(e.size);n.innerHTML=`\n        <div class="hydrous-message-file-icon">${t}</div>\n        <div class="hydrous-message-file-name">${e.name} (${r})</div>\n      `,o.querySelector(".hydrous-message-bubble").appendChild(n)}}(g,u.selectedFile),m.value="",m.style.height="48px";const h=p?u.selectedFile:null;!async function(n,e,o,t,s){try{if(!navigator.onLine)throw new Error("Sin conexión a internet");if(t.isTyping=!0,function(n){a(n);const e=document.createElement("div");e.className="hydrous-typing",e.innerHTML='\n      <div class="hydrous-typing-dots">\n        <span class="hydrous-dot"></span>\n        <span class="hydrous-dot"></span>\n        <span class="hydrous-dot"></span>\n      </div>\n      <div class="hydrous-typing-text">escribiendo...</div>\n    ',n.appendChild(e),c(n)}(n),!t.conversationId||!t.conversationStarted)try{const n=await fetch(`${o.apiUrl}/chat/start`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`Error: ${n.status}`);const e=await n.json();t.conversationId=e.id,t.conversationStarted=!0,localStorage.setItem("hydrous_conversation_id",e.id)}catch(e){return console.error("Error al iniciar conversación:",e),a(n),i(n,"Lo siento, no puedo conectar con el asistente. Por favor, intenta de nuevo más tarde.",t),void(t.isTyping=!1)}if(!t.conversationId)return a(n),i(n,"Lo siento, ha ocurrido un error al conectar con el asistente. Por favor, recarga la página e intenta de nuevo.",t),void(t.isTyping=!1);if(s){console.log("Enviando archivo:",s.name);const d=new FormData;d.append("conversation_id",t.conversationId),d.append("message",e||""),d.append("file",s);try{const s=await fetch(`${o.apiUrl}/documents/upload`,{method:"POST",body:d});if(!s.ok)throw new Error(`Error: ${s.status}`);const l=await s.json();a(n),i(n,l.message||"Archivo recibido. Estamos procesando su contenido.",t),r(t.conversationId,e,l.message||"Archivo recibido. Estamos procesando su contenido.")}catch(e){console.error("Error al subir archivo:",e),a(n),i(n,"Lo siento, ha ocurrido un error al subir el archivo. Por favor, intenta de nuevo más tarde.",t)}}else{const s=await fetch(`${o.apiUrl}/chat/message`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t.conversationId,message:e})});if(!s.ok)throw new Error(`Error: ${s.status}`);const d=await s.json();a(n),i(n,d.message,t),r(t.conversationId,e,d.message)}}catch(e){console.error("Error al enviar mensaje:",e);let o="Lo siento, ha ocurrido un error al procesar tu mensaje.";"Sin conexión a internet"===e.message?o="No hay conexión a internet. Por favor, verifica tu conexión e intenta nuevamente.":e.message.includes("404")?o="No se pudo conectar con el servidor. Por favor, intenta más tarde.":e.message.includes("timeout")&&(o="La conexión tardó demasiado. Por favor, intenta nuevamente."),a(n),i(n,o,t)}finally{t.isTyping=!1}}(g,t,n,u,h),p&&function(n,o){o.selectedFile=null;const t=e.fileInput;t&&(t.value="");const r=n.querySelector(".hydrous-file-preview");r&&r.parentNode.removeChild(r);const s=n.querySelector(".hydrous-file-info");s&&(s.textContent="");if(e.sendButton){e.textarea&&e.textarea.value.trim().length>0&&!o.isTyping?(e.sendButton.classList.add("active"),e.sendButton.disabled=!1):(e.sendButton.classList.remove("active"),e.sendButton.disabled=!0)}}(y,u),o("message_sent",n,{hasFile:p})}catch(n){console.error("Error al enviar mensaje:",n);const e=y.querySelector(".hydrous-file-info");e&&(e.textContent="Error al enviar archivo. Intente de nuevo.")}finally{m.disabled=!1,m.focus(),k()}}p.addEventListener("click",(()=>{u.isOpen=!0,p.style.display="none",h.style.display="flex",g.querySelector(".hydrous-message")||async function(n,e,o){try{n.innerHTML="",o.conversationStarted=!1,o.conversationId=null;const r=t("last_conversation");if(r&&r.id){o.conversationId=r.id,r.messages&&r.messages.length>0&&r.messages.forEach((e=>{"assistant"===e.role?i(n,e.content,o,!1):"user"===e.role&&s(n,e.content,o,!1)}));try{if(!(await fetch(`${e.apiUrl}/chat/${o.conversationId}`)).ok)throw new Error("Conversación no encontrada")}catch(e){o.conversationId=null,n.innerHTML=""}}o.conversationId||(n.innerHTML=`\n          <div class="hydrous-empty-state">\n            <div class="hydrous-empty-icon">\n              <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z" stroke="${e.primaryColor}" stroke-width="2"></path>\n              </svg>\n            </div>\n            <h3 class="hydrous-empty-title">${e.title}</h3>\n            <p class="hydrous-empty-text">\n              Escriba su consulta para comenzar.\n            </p>\n          </div>\n        `)}catch(e){console.error("Error al preparar conversación:",e),i(n,"Error de conexión. Por favor, recarga la página.",o)}finally{o.isTyping=!1}}(g,n,u),setTimeout((()=>m.focus()),300),o("chat_opened",n)})),v.addEventListener("click",(()=>{u.isOpen=!1,h.style.display="none",p.style.display="flex",o("chat_closed",n)})),w.addEventListener("click",(()=>{confirm("¿Estás seguro que deseas reiniciar la conversación? Se perderá todo el historial.")&&(!function(n,t,r){localStorage.removeItem("hydrous_conversation_id"),localStorage.removeItem("hydrous_last_conversation"),r.conversationId=null,r.messages=[],r.isConversationStarted=!1,r.selectedFile=null,n.innerHTML="",e.fileInput&&(e.fileInput.value="");const s=e.inputContainer.querySelector(".hydrous-file-preview");s&&s.parentNode.removeChild(s);n.innerHTML=`\n      <div class="hydrous-empty-state">\n        <div class="hydrous-empty-icon">\n          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z" stroke="${t.primaryColor}" stroke-width="2"></path>\n          </svg>\n        </div>\n        <h3 class="hydrous-empty-title">${t.title}</h3>\n        <p class="hydrous-empty-text">\n          Conversación reiniciada. Escriba su consulta para comenzar.\n        </p>\n      </div>\n    `,o("conversation_reset",t)}(g,n,u),k(),o("conversation_reset",n))})),m.addEventListener("input",(()=>{m.style.height="auto";const n=Math.min(m.scrollHeight,120);m.style.height=n+"px",k()})),m.addEventListener("keydown",(n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),x.disabled||C())})),f&&b&&(f.addEventListener("click",(()=>{b.click()})),b.addEventListener("change",(()=>{if(b.files&&b.files[0]){const e=b.files[0];if(e.size>1024*n.maxFileSize*1024){return y.querySelector(".hydrous-file-info").textContent=`Error: El archivo excede el límite de ${n.maxFileSize}MB`,void(b.value="")}u.selectedFile=e,function(n,e,o){window.HydrousWidget.clearFilePreview(n,o);const t=document.createElement("div");t.className="hydrous-file-preview";const r=l(e.type),s=d(e.size);t.innerHTML=`\n      <div class="hydrous-file-preview-icon">${r}</div>\n      <div class="hydrous-file-preview-name" title="${e.name}">${e.name} (${s})</div>\n      <button class="hydrous-file-preview-remove" title="Eliminar archivo">\n        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      </button>\n    `,n.querySelector(".hydrous-input-info").appendChild(t),t.querySelector(".hydrous-file-preview-remove").addEventListener("click",(()=>{window.HydrousWidget.clearFilePreview(n,o)}));const i=n.querySelector(".hydrous-file-info");i&&(i.textContent="Archivo listo para enviar")}(y,e,u),k()}})));x.addEventListener("click",(function(){console.log("Botón de envío clickeado, disabled:",x.disabled),x.disabled||C()})),window.HydrousWidget.clearFilePreview=function(n,e){e.selectedFile=null,b&&(b.value="");const o=n.querySelector(".hydrous-file-preview");o&&o.parentNode.removeChild(o);const t=n.querySelector(".hydrous-file-info");t&&(t.textContent=""),k()}}(u,p)}(g,p,{isOpen:!1,messages:[],conversationId:null,isTyping:!1,selectedFile:null}),o("widget_initialized",p),document.getElementById("hydrous-loading-indicator")&&document.getElementById("hydrous-loading-indicator").remove()}}();